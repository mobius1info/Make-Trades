import{c as H}from"./index-D488pGsG.js";let b=null,g=null,y=null,E=null;function l(){return b||(b=H("https://gknfzfxjaeuvrncgljyi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrbmZ6ZnhqYWV1dnJuY2dsanlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NzMwNjEsImV4cCI6MjA4NjE0OTA2MX0.rZoKwEl9nbE4KLh3J5MZM5FfbdtCxOJGXTSTCe9VEds")),b}function m(n){const t=document.getElementById("loginError");t&&(t.textContent=n,t.style.display="block")}function K(){const n=document.getElementById("loginError");n&&(n.style.display="none")}async function j(){try{const n=l(),{data:{session:t}}=await n.auth.getSession();if(!t)return u(),!1;const{data:e}=await n.from("admin_users").select("*").eq("id",t.user.id).maybeSingle();return e?(N(),!0):(await n.auth.signOut(),m("У вас нет прав доступа к админ-панели"),u(),!1)}catch(n){return console.error("Auth check error:",n),u(),!1}}function u(){document.getElementById("authContainer").style.display="flex",document.getElementById("adminContent").classList.remove("active")}function N(){document.getElementById("authContainer").style.display="none",document.getElementById("adminContent").classList.add("active"),V()}var h;(h=document.getElementById("loginForm"))==null||h.addEventListener("submit",async n=>{n.preventDefault(),n.stopPropagation(),K();const t=document.getElementById("loginBtn"),e=document.getElementById("email").value,o=document.getElementById("password").value;if(!e||!o){m("Введите email и пароль");return}t.disabled=!0,t.textContent="Вход...";try{const d=l(),{error:a}=await d.auth.signInWithPassword({email:e,password:o});if(a){m("Ошибка входа: "+a.message),t.disabled=!1,t.textContent="Войти";return}await j()}catch(d){m("Ошибка: "+(d.message||"попробуйте ещё раз")),t.disabled=!1,t.textContent="Войти"}});var L;(L=document.getElementById("logoutBtn"))==null||L.addEventListener("click",async()=>{try{await l().auth.signOut()}catch{}u()});document.querySelectorAll(".tab-btn").forEach(n=>{n.addEventListener("click",t=>{var d;const e=t.target,o=e.dataset.tab;document.querySelectorAll(".tab-btn").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active")),e.classList.add("active"),(d=document.getElementById(o))==null||d.classList.add("active")})});async function I(){const n=l(),{data:t,error:e}=await n.from("translations").select("*").order("key");if(e){console.error("Error loading translations:",e);return}U(t||[])}function U(n){const t=document.getElementById("translationsTable");if(n.length===0){t.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет переводов</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.value}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editTranslation('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteTranslation('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function v(){const n=l(),{data:t,error:e}=await n.from("site_images").select("*").order("key");if(e){console.error("Error loading images:",e);return}Z(t||[])}function Z(n){const t=document.getElementById("imagesTable");if(n.length===0){t.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет картинок</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><a href="${e.url}" target="_blank">${e.url.substring(0,50)}...</a></td>
      <td>${e.alt_text||"-"}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editImage('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteImage('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function B(){const n=l(),{data:t,error:e}=await n.from("blog_posts").select("*").order("created_at",{ascending:!1}).limit(100);if(e){console.error("Error loading blog posts:",e);return}z(t||[])}function z(n){const t=document.getElementById("blogTable");if(n.length===0){t.innerHTML='<tr><td colspan="6" style="text-align: center; padding: 2rem;">Нет статей</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.title}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.published?"Да":"Нет"}</td>
      <td>${new Date(e.publish_date).toLocaleDateString("ru-RU")}</td>
      <td>${e.views}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editBlogPost('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteBlogPost('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}function V(){I(),v(),B()}var w;(w=document.getElementById("addTranslationBtn"))==null||w.addEventListener("click",()=>{g=null,document.getElementById("translationModalTitle").textContent="Добавить перевод",document.getElementById("translationForm").reset(),document.getElementById("translationModal").classList.add("active")});var C;(C=document.getElementById("closeTranslationModal"))==null||C.addEventListener("click",()=>{document.getElementById("translationModal").classList.remove("active")});var M;(M=document.getElementById("translationForm"))==null||M.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("translationKey").value,e=document.getElementById("translationLanguage").value,o=document.getElementById("translationValue").value,d=document.getElementById("translationCategory").value,a={key:t,language:e,value:o,category:d},r=l();if(g){const{error:s}=await r.from("translations").update({...a,updated_at:new Date().toISOString()}).eq("id",g);if(s){alert("Ошибка обновления: "+s.message);return}}else{const{error:s}=await r.from("translations").insert([a]);if(s){alert("Ошибка добавления: "+s.message);return}}document.getElementById("translationModal").classList.remove("active"),I()});var k;(k=document.getElementById("addImageBtn"))==null||k.addEventListener("click",()=>{y=null,document.getElementById("imageModalTitle").textContent="Добавить картинку",document.getElementById("imageForm").reset(),document.getElementById("imageModal").classList.add("active")});var T;(T=document.getElementById("closeImageModal"))==null||T.addEventListener("click",()=>{document.getElementById("imageModal").classList.remove("active")});var _;(_=document.getElementById("imageForm"))==null||_.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("imageKey").value,e=document.getElementById("imageUrl").value,o=document.getElementById("imageAlt").value,d=document.getElementById("imageCategory").value,a={key:t,url:e,alt_text:o,category:d},r=l();if(y){const{error:s}=await r.from("site_images").update({...a,updated_at:new Date().toISOString()}).eq("id",y);if(s){alert("Ошибка обновления: "+s.message);return}}else{const{error:s}=await r.from("site_images").insert([a]);if(s){alert("Ошибка добавления: "+s.message);return}}document.getElementById("imageModal").classList.remove("active"),v()});var S;(S=document.getElementById("addBlogBtn"))==null||S.addEventListener("click",()=>{E=null,document.getElementById("blogModalTitle").textContent="Добавить статью",document.getElementById("blogForm").reset(),document.getElementById("blogModal").classList.add("active")});var x;(x=document.getElementById("closeBlogModal"))==null||x.addEventListener("click",()=>{document.getElementById("blogModal").classList.remove("active")});var F;(F=document.getElementById("blogForm"))==null||F.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("blogTitle").value,e=document.getElementById("blogSlug").value,o=document.getElementById("blogLanguage").value,d=document.getElementById("blogExcerpt").value,a=document.getElementById("blogContent").value,r=document.getElementById("blogImageUrl").value,s=document.getElementById("blogPublished").value==="true",i=document.getElementById("blogPublishDate").value,f={title:t,slug:e,language:o,excerpt:d,content:a,image_url:r,published:s,publish_date:i,author:"MakeTrades Team",category:"Trading",tags:["trading"],reading_time:5,meta_title:t,meta_description:d,views:0},p=l();if(E){const{error:c}=await p.from("blog_posts").update({...f,updated_at:new Date().toISOString()}).eq("id",E);if(c){alert("Ошибка обновления: "+c.message);return}}else{const{error:c}=await p.from("blog_posts").insert([f]);if(c){alert("Ошибка добавления: "+c.message);return}}document.getElementById("blogModal").classList.remove("active"),B()});window.editTranslation=async n=>{const t=l(),{data:e}=await t.from("translations").select("*").eq("id",n).single();e&&(g=n,document.getElementById("translationKey").value=e.key,document.getElementById("translationLanguage").value=e.language,document.getElementById("translationValue").value=e.value,document.getElementById("translationCategory").value=e.category,document.getElementById("translationModalTitle").textContent="Изменить перевод",document.getElementById("translationModal").classList.add("active"))};window.deleteTranslation=async n=>{if(!confirm("Удалить этот перевод?"))return;const t=l(),{error:e}=await t.from("translations").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}I()};window.editImage=async n=>{const t=l(),{data:e}=await t.from("site_images").select("*").eq("id",n).single();e&&(y=n,document.getElementById("imageKey").value=e.key,document.getElementById("imageUrl").value=e.url,document.getElementById("imageAlt").value=e.alt_text||"",document.getElementById("imageCategory").value=e.category,document.getElementById("imageModalTitle").textContent="Изменить картинку",document.getElementById("imageModal").classList.add("active"))};window.deleteImage=async n=>{if(!confirm("Удалить эту картинку?"))return;const t=l(),{error:e}=await t.from("site_images").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}v()};window.editBlogPost=async n=>{const t=l(),{data:e}=await t.from("blog_posts").select("*").eq("id",n).single();e&&(E=n,document.getElementById("blogTitle").value=e.title,document.getElementById("blogSlug").value=e.slug,document.getElementById("blogLanguage").value=e.language,document.getElementById("blogExcerpt").value=e.excerpt,document.getElementById("blogContent").value=e.content,document.getElementById("blogImageUrl").value=e.image_url,document.getElementById("blogPublished").value=e.published.toString(),document.getElementById("blogPublishDate").value=e.publish_date.replace("Z","").substring(0,16),document.getElementById("blogModalTitle").textContent="Изменить статью",document.getElementById("blogModal").classList.add("active"))};window.deleteBlogPost=async n=>{if(!confirm("Удалить эту статью?"))return;const t=l(),{error:e}=await t.from("blog_posts").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}B()};var q;(q=document.getElementById("translationSearch"))==null||q.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=document.getElementById("translationLangFilter").value,o=document.getElementById("translationCategoryFilter").value;let a=l().from("translations").select("*");e&&(a=a.eq("language",e)),o&&(a=a.eq("category",o));const{data:r}=await a,s=(r||[]).filter(i=>i.key.toLowerCase().includes(t)||i.value.toLowerCase().includes(t));U(s)});var $;($=document.getElementById("translationLangFilter"))==null||$.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("translationSearch"))==null||t.dispatchEvent(n)});var P;(P=document.getElementById("translationCategoryFilter"))==null||P.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("translationSearch"))==null||t.dispatchEvent(n)});var A;(A=document.getElementById("imageSearch"))==null||A.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=l(),{data:o}=await e.from("site_images").select("*"),d=(o||[]).filter(a=>a.key.toLowerCase().includes(t)||a.category&&a.category.toLowerCase().includes(t));Z(d)});var D;(D=document.getElementById("blogSearch"))==null||D.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=document.getElementById("blogLangFilter").value,o=document.getElementById("blogPublishedFilter").value;let a=l().from("blog_posts").select("*").limit(100);e&&(a=a.eq("language",e)),o&&(a=a.eq("published",o==="true"));const{data:r}=await a,s=(r||[]).filter(i=>i.title.toLowerCase().includes(t));z(s)});var J;(J=document.getElementById("blogLangFilter"))==null||J.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("blogSearch"))==null||t.dispatchEvent(n)});var O;(O=document.getElementById("blogPublishedFilter"))==null||O.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("blogSearch"))==null||t.dispatchEvent(n)});j();
