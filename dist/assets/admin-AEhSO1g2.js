import{c as Z}from"./index-D488pGsG.js";const K="https://gknfzfxjaeuvrncgljyi.supabase.co",z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrbmZ6ZnhqYWV1dnJuY2dsanlpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NzMwNjEsImV4cCI6MjA4NjE0OTA2MX0.rZoKwEl9nbE4KLh3J5MZM5FfbdtCxOJGXTSTCe9VEds";let o;try{o=Z(K,z)}catch(t){console.error("Supabase init error:",t),c("Ошибка инициализации. Обновите страницу.")}let u=null,g=null,y=null;function c(t){const e=document.getElementById("loginError");e&&(e.textContent=t,e.style.display="block")}function H(){const t=document.getElementById("loginError");t&&(t.style.display="none")}async function D(){try{const{data:{session:t}}=await o.auth.getSession();if(!t)return m(),!1;const{data:e}=await o.from("admin_users").select("*").eq("id",t.user.id).maybeSingle();return e?(N(),!0):(await o.auth.signOut(),c("У вас нет прав доступа к админ-панели"),m(),!1)}catch(t){return console.error("Auth check error:",t),m(),!1}}function m(){document.getElementById("authContainer").style.display="flex",document.getElementById("adminContent").classList.remove("active")}function N(){document.getElementById("authContainer").style.display="none",document.getElementById("adminContent").classList.add("active"),V()}var B;(B=document.getElementById("loginForm"))==null||B.addEventListener("submit",async t=>{t.preventDefault(),t.stopPropagation(),H();const e=document.getElementById("loginBtn"),n=document.getElementById("email").value,l=document.getElementById("password").value;if(!n||!l){c("Введите email и пароль");return}e.disabled=!0,e.textContent="Вход...";try{const{error:a}=await o.auth.signInWithPassword({email:n,password:l});if(a){c("Ошибка входа: "+a.message),e.disabled=!1,e.textContent="Войти";return}await D()}catch(a){c("Ошибка сети: "+(a.message||"попробуйте ещё раз")),e.disabled=!1,e.textContent="Войти"}});var f;(f=document.getElementById("logoutBtn"))==null||f.addEventListener("click",async()=>{await o.auth.signOut(),m()});document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",e=>{var a;const n=e.target,l=n.dataset.tab;document.querySelectorAll(".tab-btn").forEach(r=>r.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(r=>r.classList.remove("active")),n.classList.add("active"),(a=document.getElementById(l))==null||a.classList.add("active")})});async function E(){const{data:t,error:e}=await o.from("translations").select("*").order("key");if(e){console.error("Error loading translations:",e);return}J(t||[])}function J(t){const e=document.getElementById("translationsTable");if(t.length===0){e.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет переводов</td></tr>';return}e.innerHTML=t.map(n=>`
    <tr>
      <td>${n.key}</td>
      <td><strong>${n.language.toUpperCase()}</strong></td>
      <td>${n.value}</td>
      <td>${n.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editTranslation('${n.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteTranslation('${n.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function I(){const{data:t,error:e}=await o.from("site_images").select("*").order("key");if(e){console.error("Error loading images:",e);return}O(t||[])}function O(t){const e=document.getElementById("imagesTable");if(t.length===0){e.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет картинок</td></tr>';return}e.innerHTML=t.map(n=>`
    <tr>
      <td>${n.key}</td>
      <td><a href="${n.url}" target="_blank">${n.url.substring(0,50)}...</a></td>
      <td>${n.alt_text||"-"}</td>
      <td>${n.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editImage('${n.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteImage('${n.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function b(){const{data:t,error:e}=await o.from("blog_posts").select("*").order("created_at",{ascending:!1}).limit(100);if(e){console.error("Error loading blog posts:",e);return}U(t||[])}function U(t){const e=document.getElementById("blogTable");if(t.length===0){e.innerHTML='<tr><td colspan="6" style="text-align: center; padding: 2rem;">Нет статей</td></tr>';return}e.innerHTML=t.map(n=>`
    <tr>
      <td>${n.title}</td>
      <td><strong>${n.language.toUpperCase()}</strong></td>
      <td>${n.published?"✅ Да":"❌ Нет"}</td>
      <td>${new Date(n.publish_date).toLocaleDateString("ru-RU")}</td>
      <td>${n.views}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editBlogPost('${n.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteBlogPost('${n.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}function V(){E(),I(),b()}var p;(p=document.getElementById("addTranslationBtn"))==null||p.addEventListener("click",()=>{u=null,document.getElementById("translationModalTitle").textContent="Добавить перевод",document.getElementById("translationForm").reset(),document.getElementById("translationModal").classList.add("active")});var h;(h=document.getElementById("closeTranslationModal"))==null||h.addEventListener("click",()=>{document.getElementById("translationModal").classList.remove("active")});var L;(L=document.getElementById("translationForm"))==null||L.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("translationKey").value,n=document.getElementById("translationLanguage").value,l=document.getElementById("translationValue").value,a=document.getElementById("translationCategory").value,r={key:e,language:n,value:l,category:a};if(u){const{error:d}=await o.from("translations").update({...r,updated_at:new Date().toISOString()}).eq("id",u);if(d){alert("Ошибка обновления: "+d.message);return}}else{const{error:d}=await o.from("translations").insert([r]);if(d){alert("Ошибка добавления: "+d.message);return}}document.getElementById("translationModal").classList.remove("active"),E()});var w;(w=document.getElementById("addImageBtn"))==null||w.addEventListener("click",()=>{g=null,document.getElementById("imageModalTitle").textContent="Добавить картинку",document.getElementById("imageForm").reset(),document.getElementById("imageModal").classList.add("active")});var C;(C=document.getElementById("closeImageModal"))==null||C.addEventListener("click",()=>{document.getElementById("imageModal").classList.remove("active")});var M;(M=document.getElementById("imageForm"))==null||M.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("imageKey").value,n=document.getElementById("imageUrl").value,l=document.getElementById("imageAlt").value,a=document.getElementById("imageCategory").value,r={key:e,url:n,alt_text:l,category:a};if(g){const{error:d}=await o.from("site_images").update({...r,updated_at:new Date().toISOString()}).eq("id",g);if(d){alert("Ошибка обновления: "+d.message);return}}else{const{error:d}=await o.from("site_images").insert([r]);if(d){alert("Ошибка добавления: "+d.message);return}}document.getElementById("imageModal").classList.remove("active"),I()});var T;(T=document.getElementById("addBlogBtn"))==null||T.addEventListener("click",()=>{y=null,document.getElementById("blogModalTitle").textContent="Добавить статью",document.getElementById("blogForm").reset(),document.getElementById("blogModal").classList.add("active")});var k;(k=document.getElementById("closeBlogModal"))==null||k.addEventListener("click",()=>{document.getElementById("blogModal").classList.remove("active")});var _;(_=document.getElementById("blogForm"))==null||_.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("blogTitle").value,n=document.getElementById("blogSlug").value,l=document.getElementById("blogLanguage").value,a=document.getElementById("blogExcerpt").value,r=document.getElementById("blogContent").value,d=document.getElementById("blogImageUrl").value,s=document.getElementById("blogPublished").value==="true",j=document.getElementById("blogPublishDate").value,v={title:e,slug:n,language:l,excerpt:a,content:r,image_url:d,published:s,publish_date:j,author:"MakeTrades Team",category:"Trading",tags:["trading"],reading_time:5,meta_title:e,meta_description:a,views:0};if(y){const{error:i}=await o.from("blog_posts").update({...v,updated_at:new Date().toISOString()}).eq("id",y);if(i){alert("Ошибка обновления: "+i.message);return}}else{const{error:i}=await o.from("blog_posts").insert([v]);if(i){alert("Ошибка добавления: "+i.message);return}}document.getElementById("blogModal").classList.remove("active"),b()});window.editTranslation=async t=>{const{data:e}=await o.from("translations").select("*").eq("id",t).single();e&&(u=t,document.getElementById("translationKey").value=e.key,document.getElementById("translationLanguage").value=e.language,document.getElementById("translationValue").value=e.value,document.getElementById("translationCategory").value=e.category,document.getElementById("translationModalTitle").textContent="Изменить перевод",document.getElementById("translationModal").classList.add("active"))};window.deleteTranslation=async t=>{if(!confirm("Удалить этот перевод?"))return;const{error:e}=await o.from("translations").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}E()};window.editImage=async t=>{const{data:e}=await o.from("site_images").select("*").eq("id",t).single();e&&(g=t,document.getElementById("imageKey").value=e.key,document.getElementById("imageUrl").value=e.url,document.getElementById("imageAlt").value=e.alt_text||"",document.getElementById("imageCategory").value=e.category,document.getElementById("imageModalTitle").textContent="Изменить картинку",document.getElementById("imageModal").classList.add("active"))};window.deleteImage=async t=>{if(!confirm("Удалить эту картинку?"))return;const{error:e}=await o.from("site_images").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}I()};window.editBlogPost=async t=>{const{data:e}=await o.from("blog_posts").select("*").eq("id",t).single();e&&(y=t,document.getElementById("blogTitle").value=e.title,document.getElementById("blogSlug").value=e.slug,document.getElementById("blogLanguage").value=e.language,document.getElementById("blogExcerpt").value=e.excerpt,document.getElementById("blogContent").value=e.content,document.getElementById("blogImageUrl").value=e.image_url,document.getElementById("blogPublished").value=e.published.toString(),document.getElementById("blogPublishDate").value=e.publish_date.replace("Z","").substring(0,16),document.getElementById("blogModalTitle").textContent="Изменить статью",document.getElementById("blogModal").classList.add("active"))};window.deleteBlogPost=async t=>{if(!confirm("Удалить эту статью?"))return;const{error:e}=await o.from("blog_posts").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}b()};var S;(S=document.getElementById("translationSearch"))==null||S.addEventListener("input",async t=>{const e=t.target.value.toLowerCase(),n=document.getElementById("translationLangFilter").value,l=document.getElementById("translationCategoryFilter").value;let a=o.from("translations").select("*");n&&(a=a.eq("language",n)),l&&(a=a.eq("category",l));const{data:r}=await a,d=(r||[]).filter(s=>s.key.toLowerCase().includes(e)||s.value.toLowerCase().includes(e));J(d)});var x;(x=document.getElementById("translationLangFilter"))==null||x.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("translationSearch"))==null||e.dispatchEvent(t)});var F;(F=document.getElementById("translationCategoryFilter"))==null||F.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("translationSearch"))==null||e.dispatchEvent(t)});var q;(q=document.getElementById("imageSearch"))==null||q.addEventListener("input",async t=>{const e=t.target.value.toLowerCase(),{data:n}=await o.from("site_images").select("*"),l=(n||[]).filter(a=>a.key.toLowerCase().includes(e)||a.category&&a.category.toLowerCase().includes(e));O(l)});var $;($=document.getElementById("blogSearch"))==null||$.addEventListener("input",async t=>{const e=t.target.value.toLowerCase(),n=document.getElementById("blogLangFilter").value,l=document.getElementById("blogPublishedFilter").value;let a=o.from("blog_posts").select("*").limit(100);n&&(a=a.eq("language",n)),l&&(a=a.eq("published",l==="true"));const{data:r}=await a,d=(r||[]).filter(s=>s.title.toLowerCase().includes(e));U(d)});var P;(P=document.getElementById("blogLangFilter"))==null||P.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("blogSearch"))==null||e.dispatchEvent(t)});var A;(A=document.getElementById("blogPublishedFilter"))==null||A.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("blogSearch"))==null||e.dispatchEvent(t)});D();
