import{c as J}from"./index-Cfu0LHQK.js";const N="https://vhahxcmzpaxosthlorfm.supabase.co",H="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZoYWh4Y216cGF4b3N0aGxvcmZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NjQwMDMsImV4cCI6MjA4NTI0MDAwM30.N7xuauIevwt0lI2jbeyQdby9vTPa20IsaqnQg2xRUWo",l=J(N,H);let c=null,m=null,u=null;async function D(){const{data:{session:t}}=await l.auth.getSession();if(!t)return g(),!1;const{data:e}=await l.from("admin_users").select("*").eq("id",t.user.id).maybeSingle();return e?(t.user,Z(),!0):(await l.auth.signOut(),alert("У вас нет прав доступа к админ-панели"),g(),!1)}function g(){document.getElementById("authContainer").style.display="flex",document.getElementById("adminContent").classList.remove("active")}function Z(){document.getElementById("authContainer").style.display="none",document.getElementById("adminContent").classList.add("active"),K()}var b;(b=document.getElementById("loginForm"))==null||b.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("email").value,n=document.getElementById("password").value,{error:o}=await l.auth.signInWithPassword({email:e,password:n});if(o){alert("Ошибка входа: "+o.message);return}await D()});var B;(B=document.getElementById("logoutBtn"))==null||B.addEventListener("click",async()=>{await l.auth.signOut(),g()});document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",e=>{var a;const n=e.target,o=n.dataset.tab;document.querySelectorAll(".tab-btn").forEach(s=>s.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(s=>s.classList.remove("active")),n.classList.add("active"),(a=document.getElementById(o))==null||a.classList.add("active")})});async function y(){const{data:t,error:e}=await l.from("translations").select("*").order("key");if(e){console.error("Error loading translations:",e);return}A(t||[])}function A(t){const e=document.getElementById("translationsTable");if(t.length===0){e.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет переводов</td></tr>';return}e.innerHTML=t.map(n=>`
    <tr>
      <td>${n.key}</td>
      <td><strong>${n.language.toUpperCase()}</strong></td>
      <td>${n.value}</td>
      <td>${n.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editTranslation('${n.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteTranslation('${n.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function I(){const{data:t,error:e}=await l.from("site_images").select("*").order("key");if(e){console.error("Error loading images:",e);return}U(t||[])}function U(t){const e=document.getElementById("imagesTable");if(t.length===0){e.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет картинок</td></tr>';return}e.innerHTML=t.map(n=>`
    <tr>
      <td>${n.key}</td>
      <td><a href="${n.url}" target="_blank">${n.url.substring(0,50)}...</a></td>
      <td>${n.alt_text||"-"}</td>
      <td>${n.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editImage('${n.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteImage('${n.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function E(){const{data:t,error:e}=await l.from("blog_posts").select("*").order("created_at",{ascending:!1}).limit(100);if(e){console.error("Error loading blog posts:",e);return}j(t||[])}function j(t){const e=document.getElementById("blogTable");if(t.length===0){e.innerHTML='<tr><td colspan="6" style="text-align: center; padding: 2rem;">Нет статей</td></tr>';return}e.innerHTML=t.map(n=>`
    <tr>
      <td>${n.title}</td>
      <td><strong>${n.language.toUpperCase()}</strong></td>
      <td>${n.published?"✅ Да":"❌ Нет"}</td>
      <td>${new Date(n.publish_date).toLocaleDateString("ru-RU")}</td>
      <td>${n.views}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editBlogPost('${n.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteBlogPost('${n.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}function K(){y(),I(),E()}var f;(f=document.getElementById("addTranslationBtn"))==null||f.addEventListener("click",()=>{c=null,document.getElementById("translationModalTitle").textContent="Добавить перевод",document.getElementById("translationForm").reset(),document.getElementById("translationModal").classList.add("active")});var w;(w=document.getElementById("closeTranslationModal"))==null||w.addEventListener("click",()=>{document.getElementById("translationModal").classList.remove("active")});var p;(p=document.getElementById("translationForm"))==null||p.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("translationKey").value,n=document.getElementById("translationLanguage").value,o=document.getElementById("translationValue").value,a=document.getElementById("translationCategory").value,s={key:e,language:n,value:o,category:a};if(c){const{error:d}=await l.from("translations").update({...s,updated_at:new Date().toISOString()}).eq("id",c);if(d){alert("Ошибка обновления: "+d.message);return}}else{const{error:d}=await l.from("translations").insert([s]);if(d){alert("Ошибка добавления: "+d.message);return}}document.getElementById("translationModal").classList.remove("active"),y()});var L;(L=document.getElementById("addImageBtn"))==null||L.addEventListener("click",()=>{m=null,document.getElementById("imageModalTitle").textContent="Добавить картинку",document.getElementById("imageForm").reset(),document.getElementById("imageModal").classList.add("active")});var h;(h=document.getElementById("closeImageModal"))==null||h.addEventListener("click",()=>{document.getElementById("imageModal").classList.remove("active")});var M;(M=document.getElementById("imageForm"))==null||M.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("imageKey").value,n=document.getElementById("imageUrl").value,o=document.getElementById("imageAlt").value,a=document.getElementById("imageCategory").value,s={key:e,url:n,alt_text:o,category:a};if(m){const{error:d}=await l.from("site_images").update({...s,updated_at:new Date().toISOString()}).eq("id",m);if(d){alert("Ошибка обновления: "+d.message);return}}else{const{error:d}=await l.from("site_images").insert([s]);if(d){alert("Ошибка добавления: "+d.message);return}}document.getElementById("imageModal").classList.remove("active"),I()});var C;(C=document.getElementById("addBlogBtn"))==null||C.addEventListener("click",()=>{u=null,document.getElementById("blogModalTitle").textContent="Добавить статью",document.getElementById("blogForm").reset(),document.getElementById("blogModal").classList.add("active")});var T;(T=document.getElementById("closeBlogModal"))==null||T.addEventListener("click",()=>{document.getElementById("blogModal").classList.remove("active")});var k;(k=document.getElementById("blogForm"))==null||k.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("blogTitle").value,n=document.getElementById("blogSlug").value,o=document.getElementById("blogLanguage").value,a=document.getElementById("blogExcerpt").value,s=document.getElementById("blogContent").value,d=document.getElementById("blogImageUrl").value,i=document.getElementById("blogPublished").value==="true",O=document.getElementById("blogPublishDate").value,v={title:e,slug:n,language:o,excerpt:a,content:s,image_url:d,published:i,publish_date:O,author:"MakeTrades Team",category:"Trading",tags:["trading"],reading_time:5,meta_title:e,meta_description:a,views:0};if(u){const{error:r}=await l.from("blog_posts").update({...v,updated_at:new Date().toISOString()}).eq("id",u);if(r){alert("Ошибка обновления: "+r.message);return}}else{const{error:r}=await l.from("blog_posts").insert([v]);if(r){alert("Ошибка добавления: "+r.message);return}}document.getElementById("blogModal").classList.remove("active"),E()});window.editTranslation=async t=>{const{data:e}=await l.from("translations").select("*").eq("id",t).single();e&&(c=t,document.getElementById("translationKey").value=e.key,document.getElementById("translationLanguage").value=e.language,document.getElementById("translationValue").value=e.value,document.getElementById("translationCategory").value=e.category,document.getElementById("translationModalTitle").textContent="Изменить перевод",document.getElementById("translationModal").classList.add("active"))};window.deleteTranslation=async t=>{if(!confirm("Удалить этот перевод?"))return;const{error:e}=await l.from("translations").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}y()};window.editImage=async t=>{const{data:e}=await l.from("site_images").select("*").eq("id",t).single();e&&(m=t,document.getElementById("imageKey").value=e.key,document.getElementById("imageUrl").value=e.url,document.getElementById("imageAlt").value=e.alt_text||"",document.getElementById("imageCategory").value=e.category,document.getElementById("imageModalTitle").textContent="Изменить картинку",document.getElementById("imageModal").classList.add("active"))};window.deleteImage=async t=>{if(!confirm("Удалить эту картинку?"))return;const{error:e}=await l.from("site_images").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}I()};window.editBlogPost=async t=>{const{data:e}=await l.from("blog_posts").select("*").eq("id",t).single();e&&(u=t,document.getElementById("blogTitle").value=e.title,document.getElementById("blogSlug").value=e.slug,document.getElementById("blogLanguage").value=e.language,document.getElementById("blogExcerpt").value=e.excerpt,document.getElementById("blogContent").value=e.content,document.getElementById("blogImageUrl").value=e.image_url,document.getElementById("blogPublished").value=e.published.toString(),document.getElementById("blogPublishDate").value=e.publish_date.replace("Z","").substring(0,16),document.getElementById("blogModalTitle").textContent="Изменить статью",document.getElementById("blogModal").classList.add("active"))};window.deleteBlogPost=async t=>{if(!confirm("Удалить эту статью?"))return;const{error:e}=await l.from("blog_posts").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}E()};var _;(_=document.getElementById("translationSearch"))==null||_.addEventListener("input",async t=>{const e=t.target.value.toLowerCase(),n=document.getElementById("translationLangFilter").value,o=document.getElementById("translationCategoryFilter").value;let a=l.from("translations").select("*");n&&(a=a.eq("language",n)),o&&(a=a.eq("category",o));const{data:s}=await a,d=(s||[]).filter(i=>i.key.toLowerCase().includes(e)||i.value.toLowerCase().includes(e));A(d)});var S;(S=document.getElementById("translationLangFilter"))==null||S.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("translationSearch"))==null||e.dispatchEvent(t)});var F;(F=document.getElementById("translationCategoryFilter"))==null||F.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("translationSearch"))==null||e.dispatchEvent(t)});var x;(x=document.getElementById("imageSearch"))==null||x.addEventListener("input",async t=>{const e=t.target.value.toLowerCase(),{data:n}=await l.from("site_images").select("*"),o=(n||[]).filter(a=>a.key.toLowerCase().includes(e)||a.category&&a.category.toLowerCase().includes(e));U(o)});var q;(q=document.getElementById("blogSearch"))==null||q.addEventListener("input",async t=>{const e=t.target.value.toLowerCase(),n=document.getElementById("blogLangFilter").value,o=document.getElementById("blogPublishedFilter").value;let a=l.from("blog_posts").select("*").limit(100);n&&(a=a.eq("language",n)),o&&(a=a.eq("published",o==="true"));const{data:s}=await a,d=(s||[]).filter(i=>i.title.toLowerCase().includes(e));j(d)});var $;($=document.getElementById("blogLangFilter"))==null||$.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("blogSearch"))==null||e.dispatchEvent(t)});var P;(P=document.getElementById("blogPublishedFilter"))==null||P.addEventListener("change",()=>{var e;const t=new Event("input");(e=document.getElementById("blogSearch"))==null||e.dispatchEvent(t)});D();
