import{b as X}from"./supabase-BZBwCKW6.js";let f=null,v=null,B=null;function d(){return X}function E(n){const t=document.getElementById("loginError");t&&(t.textContent=n,t.style.display="block")}function Y(){const n=document.getElementById("loginError");n&&(n.style.display="none")}async function Z(){try{const n=d(),{data:{session:t}}=await n.auth.getSession();if(!t)return b(),!1;const{data:e}=await n.from("admin_users").select("*").eq("id",t.user.id).maybeSingle();return e?(ee(),!0):(await n.auth.signOut(),E("У вас нет прав доступа к админ-панели"),b(),!1)}catch(n){return console.error("Auth check error:",n),b(),!1}}function b(){document.getElementById("authContainer").style.display="flex",document.getElementById("adminContent").classList.remove("active")}function ee(){document.getElementById("authContainer").style.display="none",document.getElementById("adminContent").classList.add("active"),Q()}var C;(C=document.getElementById("loginForm"))==null||C.addEventListener("submit",async n=>{n.preventDefault(),n.stopPropagation(),Y();const t=document.getElementById("loginBtn"),e=document.getElementById("email").value,o=document.getElementById("password").value;if(!e||!o){E("Введите email и пароль");return}t.disabled=!0,t.textContent="Вход...";try{const s=d(),{error:a}=await s.auth.signInWithPassword({email:e,password:o});if(a){E("Ошибка входа: "+a.message),t.disabled=!1,t.textContent="Войти";return}await Z()}catch(s){E("Ошибка: "+(s.message||"попробуйте ещё раз")),t.disabled=!1,t.textContent="Войти"}});var k;(k=document.getElementById("refreshBtn"))==null||k.addEventListener("click",async()=>{const n=document.getElementById("refreshIcon"),t=document.getElementById("refreshBtn");n&&(n.style.transform="rotate(360deg)"),t.disabled=!0;try{await Q()}finally{t.disabled=!1,setTimeout(()=>{n&&(n.style.transform="")},600)}});var _;(_=document.getElementById("logoutBtn"))==null||_.addEventListener("click",async()=>{try{await d().auth.signOut()}catch{}b()});document.querySelectorAll(".tab-btn").forEach(n=>{n.addEventListener("click",t=>{var s;const e=t.target,o=e.dataset.tab;document.querySelectorAll(".tab-btn").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active")),e.classList.add("active"),(s=document.getElementById(o))==null||s.classList.add("active")})});async function w(){const n=d(),{data:t,error:e}=await n.from("translations").select("*").order("key");if(e){console.error("Error loading translations:",e);return}z(t||[])}function z(n){const t=document.getElementById("translationsTable");if(n.length===0){t.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет переводов</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.value}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editTranslation('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteTranslation('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function L(){const n=d(),{data:t,error:e}=await n.from("site_images").select("*").order("key");if(e){console.error("Error loading images:",e);return}G(t||[])}function G(n){const t=document.getElementById("imagesTable");if(n.length===0){t.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет картинок</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><a href="${e.url}" target="_blank">${e.url.substring(0,50)}...</a></td>
      <td>${e.alt_text||"-"}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editImage('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteImage('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function p(){const n=d(),{data:t,error:e}=await n.from("blog_posts").select("*").order("created_at",{ascending:!1});if(e){console.error("Error loading blog posts:",e);return}J(t||[])}function J(n){const t=document.getElementById("blogTable");if(n.length===0){t.innerHTML='<tr><td colspan="6" style="text-align: center; padding: 2rem;">Нет статей</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.title}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.published?"Да":"Нет"}</td>
      <td>${new Date(e.publish_date).toLocaleDateString("ru-RU")}</td>
      <td>${e.views}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editBlogPost('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteBlogPost('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}let m=[];async function I(){const n=d(),{data:t,error:e}=await n.from("leads").select("*").order("created_at",{ascending:!1});if(e){console.error("Error loading leads:",e);return}m=t||[];const o=m.filter(i=>i.is_new).length,s=m.filter(i=>i.source==="demo").length,a=m.filter(i=>i.source==="contact").length,l=document.getElementById("leadsBadge");l&&(l.textContent=String(o),l.classList.toggle("visible",o>0));const r=document.getElementById("leadsTotal"),c=document.getElementById("leadsNew"),u=document.getElementById("leadsDemo"),g=document.getElementById("leadsContact");r&&(r.textContent=String(m.length)),c&&(c.textContent=String(o)),u&&(u.textContent=String(s)),g&&(g.textContent=String(a)),h()}function h(){var o,s,a;const n=((s=(o=document.getElementById("leadsSearch"))==null?void 0:o.value)==null?void 0:s.toLowerCase())||"",t=((a=document.getElementById("leadsSourceFilter"))==null?void 0:a.value)||"";let e=m;t&&(e=e.filter(l=>l.source===t)),n&&(e=e.filter(l=>l.name&&l.name.toLowerCase().includes(n)||l.email&&l.email.toLowerCase().includes(n)||l.telegram&&l.telegram.toLowerCase().includes(n)||l.message&&l.message.toLowerCase().includes(n))),te(e)}function te(n){const t=document.getElementById("leadsContainer");if(n.length===0){t.innerHTML=`
      <div class="empty-leads">
        <div class="empty-leads-icon">--</div>
        <p>Заявок пока нет</p>
      </div>`;return}t.innerHTML=n.map(e=>{const o=new Date(e.created_at).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),s=e.source==="demo"?"Demo":"Contact",a=e.source==="demo"?"demo":"contact";return`
      <div class="lead-card ${e.is_new?"is-new":""}">
        <div class="lead-card-header">
          <span class="lead-name">${y(e.name||"Без имени")}</span>
          <span class="lead-source ${a}">${s}</span>
        </div>
        <div class="lead-meta">
          <span>&#9993; ${y(e.email)}</span>
          ${e.telegram?`<span>&#9992; ${y(e.telegram)}</span>`:""}
          <span>&#128339; ${o}</span>
          ${e.language?`<span>&#127760; ${e.language.toUpperCase()}</span>`:""}
        </div>
        ${e.message?`<div class="lead-message">${y(e.message)}</div>`:""}
        <div class="lead-actions">
          ${e.is_new?`<button class="action-btn btn-edit" onclick="markLeadRead('${e.id}')">Прочитано</button>`:""}
          <button class="action-btn btn-delete" onclick="deleteLead('${e.id}')">Удалить</button>
        </div>
      </div>`}).join("")}function y(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}window.markLeadRead=async n=>{try{const t=d(),{error:e}=await t.from("leads").update({is_new:!1}).eq("id",n);if(e){console.error("Error marking lead as read:",e),alert("Ошибка обновления: "+e.message);return}await I()}catch(t){console.error("Error in markLeadRead:",t),alert("Ошибка: "+(t.message||"Не удалось обновить заявку"))}};window.deleteLead=async n=>{if(confirm("Удалить эту заявку?"))try{const t=d(),{error:e}=await t.from("leads").delete().eq("id",n);if(e){console.error("Error deleting lead:",e),alert("Ошибка удаления: "+e.message);return}await I()}catch(t){console.error("Error in deleteLead:",t),alert("Ошибка: "+(t.message||"Не удалось удалить заявку"))}};var $;($=document.getElementById("markAllReadBtn"))==null||$.addEventListener("click",async()=>{try{const n=d(),{error:t}=await n.from("leads").update({is_new:!1}).eq("is_new",!0);if(t){console.error("Error marking all leads as read:",t),alert("Ошибка обновления всех заявок: "+t.message);return}await I()}catch(n){console.error("Error in markAllReadBtn:",n),alert("Ошибка: "+(n.message||"Не удалось обновить заявки"))}});var T;(T=document.getElementById("leadsSearch"))==null||T.addEventListener("input",()=>{h()});var S;(S=document.getElementById("leadsSourceFilter"))==null||S.addEventListener("change",()=>{h()});function Q(){I(),w(),L(),p()}var M;(M=document.getElementById("addTranslationBtn"))==null||M.addEventListener("click",()=>{f=null,document.getElementById("translationModalTitle").textContent="Добавить перевод",document.getElementById("translationForm").reset(),document.getElementById("translationModal").classList.add("active")});var x;(x=document.getElementById("closeTranslationModal"))==null||x.addEventListener("click",()=>{document.getElementById("translationModal").classList.remove("active")});var F;(F=document.getElementById("translationForm"))==null||F.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("translationKey").value,e=document.getElementById("translationLanguage").value,o=document.getElementById("translationValue").value,s=document.getElementById("translationCategory").value,a={key:t,language:e,value:o,category:s},l=d();if(f){const{error:r}=await l.from("translations").update({...a,updated_at:new Date().toISOString()}).eq("id",f);if(r){alert("Ошибка обновления: "+r.message);return}}else{const{error:r}=await l.from("translations").insert([a]);if(r){alert("Ошибка добавления: "+r.message);return}}document.getElementById("translationModal").classList.remove("active"),w()});var q;(q=document.getElementById("addImageBtn"))==null||q.addEventListener("click",()=>{v=null,document.getElementById("imageModalTitle").textContent="Добавить картинку",document.getElementById("imageForm").reset(),document.getElementById("imageModal").classList.add("active")});var D;(D=document.getElementById("closeImageModal"))==null||D.addEventListener("click",()=>{document.getElementById("imageModal").classList.remove("active")});var P;(P=document.getElementById("imageForm"))==null||P.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("imageKey").value,e=document.getElementById("imageUrl").value,o=document.getElementById("imageAlt").value,s=document.getElementById("imageCategory").value,a={key:t,url:e,alt_text:o,category:s},l=d();if(v){const{error:r}=await l.from("site_images").update({...a,updated_at:new Date().toISOString()}).eq("id",v);if(r){alert("Ошибка обновления: "+r.message);return}}else{const{error:r}=await l.from("site_images").insert([a]);if(r){alert("Ошибка добавления: "+r.message);return}}document.getElementById("imageModal").classList.remove("active"),L()});var A;(A=document.getElementById("addBlogBtn"))==null||A.addEventListener("click",()=>{B=null,document.getElementById("blogModalTitle").textContent="Добавить статью",document.getElementById("blogForm").reset(),document.getElementById("blogModal").classList.add("active")});var H;(H=document.getElementById("closeBlogModal"))==null||H.addEventListener("click",()=>{document.getElementById("blogModal").classList.remove("active")});var U;(U=document.getElementById("blogForm"))==null||U.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("blogTitle").value,e=document.getElementById("blogSlug").value,o=document.getElementById("blogLanguage").value,s=document.getElementById("blogExcerpt").value,a=document.getElementById("blogContent").value,l=document.getElementById("blogImageUrl").value,r=document.getElementById("blogPublished").value==="true",c=document.getElementById("blogPublishDate").value,u={title:t,slug:e,language:o,excerpt:s,content:a,image_url:l,published:r,publish_date:c,author:"MakeTrades Team",category:"Trading",tags:["trading"],reading_time:5,meta_title:t,meta_description:s,views:0},g=d();if(B){const{error:i}=await g.from("blog_posts").update({...u,updated_at:new Date().toISOString()}).eq("id",B);if(i){alert("Ошибка обновления: "+i.message);return}}else{const{error:i}=await g.from("blog_posts").insert([u]);if(i){alert("Ошибка добавления: "+i.message);return}}document.getElementById("blogModal").classList.remove("active"),p()});window.editTranslation=async n=>{const t=d(),{data:e}=await t.from("translations").select("*").eq("id",n).single();e&&(f=n,document.getElementById("translationKey").value=e.key,document.getElementById("translationLanguage").value=e.language,document.getElementById("translationValue").value=e.value,document.getElementById("translationCategory").value=e.category,document.getElementById("translationModalTitle").textContent="Изменить перевод",document.getElementById("translationModal").classList.add("active"))};window.deleteTranslation=async n=>{if(!confirm("Удалить этот перевод?"))return;const t=d(),{error:e}=await t.from("translations").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}w()};window.editImage=async n=>{const t=d(),{data:e}=await t.from("site_images").select("*").eq("id",n).single();e&&(v=n,document.getElementById("imageKey").value=e.key,document.getElementById("imageUrl").value=e.url,document.getElementById("imageAlt").value=e.alt_text||"",document.getElementById("imageCategory").value=e.category,document.getElementById("imageModalTitle").textContent="Изменить картинку",document.getElementById("imageModal").classList.add("active"))};window.deleteImage=async n=>{if(!confirm("Удалить эту картинку?"))return;const t=d(),{error:e}=await t.from("site_images").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}L()};window.editBlogPost=async n=>{const t=d(),{data:e}=await t.from("blog_posts").select("*").eq("id",n).single();e&&(B=n,document.getElementById("blogTitle").value=e.title,document.getElementById("blogSlug").value=e.slug,document.getElementById("blogLanguage").value=e.language,document.getElementById("blogExcerpt").value=e.excerpt,document.getElementById("blogContent").value=e.content,document.getElementById("blogImageUrl").value=e.image_url,document.getElementById("blogPublished").value=e.published.toString(),document.getElementById("blogPublishDate").value=e.publish_date.replace("Z","").substring(0,16),document.getElementById("blogModalTitle").textContent="Изменить статью",document.getElementById("blogModal").classList.add("active"))};window.deleteBlogPost=async n=>{if(!confirm("Удалить эту статью?"))return;const t=d(),{error:e}=await t.from("blog_posts").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}p()};var R;(R=document.getElementById("translationSearch"))==null||R.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=document.getElementById("translationLangFilter").value,o=document.getElementById("translationCategoryFilter").value;let a=d().from("translations").select("*");e&&(a=a.eq("language",e)),o&&(a=a.eq("category",o));const{data:l}=await a,r=(l||[]).filter(c=>c.key.toLowerCase().includes(t)||c.value.toLowerCase().includes(t));z(r)});var O;(O=document.getElementById("translationLangFilter"))==null||O.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("translationSearch"))==null||t.dispatchEvent(n)});var j;(j=document.getElementById("translationCategoryFilter"))==null||j.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("translationSearch"))==null||t.dispatchEvent(n)});var K;(K=document.getElementById("imageSearch"))==null||K.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=d(),{data:o}=await e.from("site_images").select("*"),s=(o||[]).filter(a=>a.key.toLowerCase().includes(t)||a.category&&a.category.toLowerCase().includes(t));G(s)});var N;(N=document.getElementById("blogSearch"))==null||N.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=document.getElementById("blogLangFilter").value,o=document.getElementById("blogPublishedFilter").value;let a=d().from("blog_posts").select("*");e&&(a=a.eq("language",e)),o&&(a=a.eq("published",o==="true"));const{data:l}=await a,r=(l||[]).filter(c=>c.title.toLowerCase().includes(t));J(r)});var V;(V=document.getElementById("blogLangFilter"))==null||V.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("blogSearch"))==null||t.dispatchEvent(n)});var W;(W=document.getElementById("blogPublishedFilter"))==null||W.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("blogSearch"))==null||t.dispatchEvent(n)});Z();
