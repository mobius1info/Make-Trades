import{b as J}from"./supabase-BKCL4Eps.js";let v=null,I=null,f=null;function d(){return J}function E(t){const n=document.getElementById("loginError");n&&(n.textContent=t,n.style.display="block")}function Q(){const t=document.getElementById("loginError");t&&(t.style.display="none")}async function W(){try{const t=d(),{data:{session:n}}=await t.auth.getSession();if(!n)return b(),!1;const{data:e}=await t.from("admin_users").select("*").eq("id",n.user.id).maybeSingle();return e?(X(),!0):(await t.auth.signOut(),E("У вас нет прав доступа к админ-панели"),b(),!1)}catch(t){return console.error("Auth check error:",t),b(),!1}}function b(){document.getElementById("authContainer").style.display="flex",document.getElementById("adminContent").classList.remove("active")}function X(){document.getElementById("authContainer").style.display="none",document.getElementById("adminContent").classList.add("active"),ee()}var C;(C=document.getElementById("loginForm"))==null||C.addEventListener("submit",async t=>{t.preventDefault(),t.stopPropagation(),Q();const n=document.getElementById("loginBtn"),e=document.getElementById("email").value,o=document.getElementById("password").value;if(!e||!o){E("Введите email и пароль");return}n.disabled=!0,n.textContent="Вход...";try{const s=d(),{error:a}=await s.auth.signInWithPassword({email:e,password:o});if(a){E("Ошибка входа: "+a.message),n.disabled=!1,n.textContent="Войти";return}await W()}catch(s){E("Ошибка: "+(s.message||"попробуйте ещё раз")),n.disabled=!1,n.textContent="Войти"}});var _;(_=document.getElementById("logoutBtn"))==null||_.addEventListener("click",async()=>{try{await d().auth.signOut()}catch{}b()});document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",n=>{var s;const e=n.target,o=e.dataset.tab;document.querySelectorAll(".tab-btn").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active")),e.classList.add("active"),(s=document.getElementById(o))==null||s.classList.add("active")})});async function w(){const t=d(),{data:n,error:e}=await t.from("translations").select("*").order("key");if(e){console.error("Error loading translations:",e);return}Z(n||[])}function Z(t){const n=document.getElementById("translationsTable");if(t.length===0){n.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет переводов</td></tr>';return}n.innerHTML=t.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.value}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editTranslation('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteTranslation('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function L(){const t=d(),{data:n,error:e}=await t.from("site_images").select("*").order("key");if(e){console.error("Error loading images:",e);return}z(n||[])}function z(t){const n=document.getElementById("imagesTable");if(t.length===0){n.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет картинок</td></tr>';return}n.innerHTML=t.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><a href="${e.url}" target="_blank">${e.url.substring(0,50)}...</a></td>
      <td>${e.alt_text||"-"}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editImage('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteImage('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function p(){const t=d(),{data:n,error:e}=await t.from("blog_posts").select("*").order("created_at",{ascending:!1}).limit(100);if(e){console.error("Error loading blog posts:",e);return}G(n||[])}function G(t){const n=document.getElementById("blogTable");if(t.length===0){n.innerHTML='<tr><td colspan="6" style="text-align: center; padding: 2rem;">Нет статей</td></tr>';return}n.innerHTML=t.map(e=>`
    <tr>
      <td>${e.title}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.published?"Да":"Нет"}</td>
      <td>${new Date(e.publish_date).toLocaleDateString("ru-RU")}</td>
      <td>${e.views}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editBlogPost('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteBlogPost('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}let m=[];async function B(){const t=d(),{data:n,error:e}=await t.from("leads").select("*").order("created_at",{ascending:!1});if(e){console.error("Error loading leads:",e);return}m=n||[];const o=m.filter(i=>i.is_new).length,s=m.filter(i=>i.source==="demo").length,a=m.filter(i=>i.source==="contact").length,l=document.getElementById("leadsBadge");l&&(l.textContent=String(o),l.classList.toggle("visible",o>0));const r=document.getElementById("leadsTotal"),c=document.getElementById("leadsNew"),u=document.getElementById("leadsDemo"),g=document.getElementById("leadsContact");r&&(r.textContent=String(m.length)),c&&(c.textContent=String(o)),u&&(u.textContent=String(s)),g&&(g.textContent=String(a)),h()}function h(){var o,s,a;const t=((s=(o=document.getElementById("leadsSearch"))==null?void 0:o.value)==null?void 0:s.toLowerCase())||"",n=((a=document.getElementById("leadsSourceFilter"))==null?void 0:a.value)||"";let e=m;n&&(e=e.filter(l=>l.source===n)),t&&(e=e.filter(l=>l.name&&l.name.toLowerCase().includes(t)||l.email&&l.email.toLowerCase().includes(t)||l.telegram&&l.telegram.toLowerCase().includes(t)||l.message&&l.message.toLowerCase().includes(t))),Y(e)}function Y(t){const n=document.getElementById("leadsContainer");if(t.length===0){n.innerHTML=`
      <div class="empty-leads">
        <div class="empty-leads-icon">--</div>
        <p>Заявок пока нет</p>
      </div>`;return}n.innerHTML=t.map(e=>{const o=new Date(e.created_at).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),s=e.source==="demo"?"Demo":"Contact",a=e.source==="demo"?"demo":"contact";return`
      <div class="lead-card ${e.is_new?"is-new":""}">
        <div class="lead-card-header">
          <span class="lead-name">${y(e.name||"Без имени")}</span>
          <span class="lead-source ${a}">${s}</span>
        </div>
        <div class="lead-meta">
          <span>&#9993; ${y(e.email)}</span>
          ${e.telegram?`<span>&#9992; ${y(e.telegram)}</span>`:""}
          <span>&#128339; ${o}</span>
          ${e.language?`<span>&#127760; ${e.language.toUpperCase()}</span>`:""}
        </div>
        ${e.message?`<div class="lead-message">${y(e.message)}</div>`:""}
        <div class="lead-actions">
          ${e.is_new?`<button class="action-btn btn-edit" onclick="markLeadRead('${e.id}')">Прочитано</button>`:""}
          <button class="action-btn btn-delete" onclick="deleteLead('${e.id}')">Удалить</button>
        </div>
      </div>`}).join("")}function y(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}window.markLeadRead=async t=>{await d().from("leads").update({is_new:!1}).eq("id",t),B()};window.deleteLead=async t=>{if(!confirm("Удалить эту заявку?"))return;await d().from("leads").delete().eq("id",t),B()};var k;(k=document.getElementById("markAllReadBtn"))==null||k.addEventListener("click",async()=>{await d().from("leads").update({is_new:!1}).eq("is_new",!0),B()});var $;($=document.getElementById("leadsSearch"))==null||$.addEventListener("input",()=>{h()});var S;(S=document.getElementById("leadsSourceFilter"))==null||S.addEventListener("change",()=>{h()});function ee(){B(),w(),L(),p()}var T;(T=document.getElementById("addTranslationBtn"))==null||T.addEventListener("click",()=>{v=null,document.getElementById("translationModalTitle").textContent="Добавить перевод",document.getElementById("translationForm").reset(),document.getElementById("translationModal").classList.add("active")});var M;(M=document.getElementById("closeTranslationModal"))==null||M.addEventListener("click",()=>{document.getElementById("translationModal").classList.remove("active")});var x;(x=document.getElementById("translationForm"))==null||x.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("translationKey").value,e=document.getElementById("translationLanguage").value,o=document.getElementById("translationValue").value,s=document.getElementById("translationCategory").value,a={key:n,language:e,value:o,category:s},l=d();if(v){const{error:r}=await l.from("translations").update({...a,updated_at:new Date().toISOString()}).eq("id",v);if(r){alert("Ошибка обновления: "+r.message);return}}else{const{error:r}=await l.from("translations").insert([a]);if(r){alert("Ошибка добавления: "+r.message);return}}document.getElementById("translationModal").classList.remove("active"),w()});var F;(F=document.getElementById("addImageBtn"))==null||F.addEventListener("click",()=>{I=null,document.getElementById("imageModalTitle").textContent="Добавить картинку",document.getElementById("imageForm").reset(),document.getElementById("imageModal").classList.add("active")});var q;(q=document.getElementById("closeImageModal"))==null||q.addEventListener("click",()=>{document.getElementById("imageModal").classList.remove("active")});var D;(D=document.getElementById("imageForm"))==null||D.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("imageKey").value,e=document.getElementById("imageUrl").value,o=document.getElementById("imageAlt").value,s=document.getElementById("imageCategory").value,a={key:n,url:e,alt_text:o,category:s},l=d();if(I){const{error:r}=await l.from("site_images").update({...a,updated_at:new Date().toISOString()}).eq("id",I);if(r){alert("Ошибка обновления: "+r.message);return}}else{const{error:r}=await l.from("site_images").insert([a]);if(r){alert("Ошибка добавления: "+r.message);return}}document.getElementById("imageModal").classList.remove("active"),L()});var P;(P=document.getElementById("addBlogBtn"))==null||P.addEventListener("click",()=>{f=null,document.getElementById("blogModalTitle").textContent="Добавить статью",document.getElementById("blogForm").reset(),document.getElementById("blogModal").classList.add("active")});var A;(A=document.getElementById("closeBlogModal"))==null||A.addEventListener("click",()=>{document.getElementById("blogModal").classList.remove("active")});var H;(H=document.getElementById("blogForm"))==null||H.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("blogTitle").value,e=document.getElementById("blogSlug").value,o=document.getElementById("blogLanguage").value,s=document.getElementById("blogExcerpt").value,a=document.getElementById("blogContent").value,l=document.getElementById("blogImageUrl").value,r=document.getElementById("blogPublished").value==="true",c=document.getElementById("blogPublishDate").value,u={title:n,slug:e,language:o,excerpt:s,content:a,image_url:l,published:r,publish_date:c,author:"MakeTrades Team",category:"Trading",tags:["trading"],reading_time:5,meta_title:n,meta_description:s,views:0},g=d();if(f){const{error:i}=await g.from("blog_posts").update({...u,updated_at:new Date().toISOString()}).eq("id",f);if(i){alert("Ошибка обновления: "+i.message);return}}else{const{error:i}=await g.from("blog_posts").insert([u]);if(i){alert("Ошибка добавления: "+i.message);return}}document.getElementById("blogModal").classList.remove("active"),p()});window.editTranslation=async t=>{const n=d(),{data:e}=await n.from("translations").select("*").eq("id",t).single();e&&(v=t,document.getElementById("translationKey").value=e.key,document.getElementById("translationLanguage").value=e.language,document.getElementById("translationValue").value=e.value,document.getElementById("translationCategory").value=e.category,document.getElementById("translationModalTitle").textContent="Изменить перевод",document.getElementById("translationModal").classList.add("active"))};window.deleteTranslation=async t=>{if(!confirm("Удалить этот перевод?"))return;const n=d(),{error:e}=await n.from("translations").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}w()};window.editImage=async t=>{const n=d(),{data:e}=await n.from("site_images").select("*").eq("id",t).single();e&&(I=t,document.getElementById("imageKey").value=e.key,document.getElementById("imageUrl").value=e.url,document.getElementById("imageAlt").value=e.alt_text||"",document.getElementById("imageCategory").value=e.category,document.getElementById("imageModalTitle").textContent="Изменить картинку",document.getElementById("imageModal").classList.add("active"))};window.deleteImage=async t=>{if(!confirm("Удалить эту картинку?"))return;const n=d(),{error:e}=await n.from("site_images").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}L()};window.editBlogPost=async t=>{const n=d(),{data:e}=await n.from("blog_posts").select("*").eq("id",t).single();e&&(f=t,document.getElementById("blogTitle").value=e.title,document.getElementById("blogSlug").value=e.slug,document.getElementById("blogLanguage").value=e.language,document.getElementById("blogExcerpt").value=e.excerpt,document.getElementById("blogContent").value=e.content,document.getElementById("blogImageUrl").value=e.image_url,document.getElementById("blogPublished").value=e.published.toString(),document.getElementById("blogPublishDate").value=e.publish_date.replace("Z","").substring(0,16),document.getElementById("blogModalTitle").textContent="Изменить статью",document.getElementById("blogModal").classList.add("active"))};window.deleteBlogPost=async t=>{if(!confirm("Удалить эту статью?"))return;const n=d(),{error:e}=await n.from("blog_posts").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}p()};var U;(U=document.getElementById("translationSearch"))==null||U.addEventListener("input",async t=>{const n=t.target.value.toLowerCase(),e=document.getElementById("translationLangFilter").value,o=document.getElementById("translationCategoryFilter").value;let a=d().from("translations").select("*");e&&(a=a.eq("language",e)),o&&(a=a.eq("category",o));const{data:l}=await a,r=(l||[]).filter(c=>c.key.toLowerCase().includes(n)||c.value.toLowerCase().includes(n));Z(r)});var R;(R=document.getElementById("translationLangFilter"))==null||R.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("translationSearch"))==null||n.dispatchEvent(t)});var O;(O=document.getElementById("translationCategoryFilter"))==null||O.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("translationSearch"))==null||n.dispatchEvent(t)});var j;(j=document.getElementById("imageSearch"))==null||j.addEventListener("input",async t=>{const n=t.target.value.toLowerCase(),e=d(),{data:o}=await e.from("site_images").select("*"),s=(o||[]).filter(a=>a.key.toLowerCase().includes(n)||a.category&&a.category.toLowerCase().includes(n));z(s)});var K;(K=document.getElementById("blogSearch"))==null||K.addEventListener("input",async t=>{const n=t.target.value.toLowerCase(),e=document.getElementById("blogLangFilter").value,o=document.getElementById("blogPublishedFilter").value;let a=d().from("blog_posts").select("*").limit(100);e&&(a=a.eq("language",e)),o&&(a=a.eq("published",o==="true"));const{data:l}=await a,r=(l||[]).filter(c=>c.title.toLowerCase().includes(n));G(r)});var N;(N=document.getElementById("blogLangFilter"))==null||N.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("blogSearch"))==null||n.dispatchEvent(t)});var V;(V=document.getElementById("blogPublishedFilter"))==null||V.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("blogSearch"))==null||n.dispatchEvent(t)});W();
