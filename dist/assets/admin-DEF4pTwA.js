import{s as X}from"./supabase-Oy0nagOi.js";let b=null,v=null,B=null;function d(){return X}function E(n){const t=document.getElementById("loginError");t&&(t.textContent=n,t.style.display="block")}function Y(){const n=document.getElementById("loginError");n&&(n.style.display="none")}async function W(){try{const n=d(),{data:{session:t}}=await n.auth.getSession();if(!t)return f(),!1;const{data:e}=await n.from("admin_users").select("*").eq("id",t.user.id).maybeSingle();return e?(ee(),!0):(await n.auth.signOut(),E("У вас нет прав доступа к админ-панели"),f(),!1)}catch(n){return console.error("Auth check error:",n),f(),!1}}function f(){document.getElementById("authContainer").style.display="flex",document.getElementById("adminContent").classList.remove("active")}function ee(){document.getElementById("authContainer").style.display="none",document.getElementById("adminContent").classList.add("active"),Q()}var C;(C=document.getElementById("loginForm"))==null||C.addEventListener("submit",async n=>{n.preventDefault(),n.stopPropagation(),Y();const t=document.getElementById("loginBtn"),e=document.getElementById("email").value,s=document.getElementById("password").value;if(!e||!s){E("Введите email и пароль");return}t.disabled=!0,t.textContent="Вход...";try{const l=d(),{error:a}=await l.auth.signInWithPassword({email:e,password:s});if(a){E("Ошибка входа: "+a.message),t.disabled=!1,t.textContent="Войти";return}await W()}catch(l){E("Ошибка: "+(l.message||"попробуйте ещё раз")),t.disabled=!1,t.textContent="Войти"}});var _;(_=document.getElementById("refreshBtn"))==null||_.addEventListener("click",async()=>{const n=document.getElementById("refreshIcon"),t=document.getElementById("refreshBtn");n&&(n.style.transform="rotate(360deg)"),t.disabled=!0;try{await Q()}finally{t.disabled=!1,setTimeout(()=>{n&&(n.style.transform="")},600)}});var k;(k=document.getElementById("logoutBtn"))==null||k.addEventListener("click",async()=>{try{await d().auth.signOut()}catch{}f()});document.querySelectorAll(".tab-btn").forEach(n=>{n.addEventListener("click",t=>{var l;const e=t.target,s=e.dataset.tab;document.querySelectorAll(".tab-btn").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active")),e.classList.add("active"),(l=document.getElementById(s))==null||l.classList.add("active")})});async function p(){const n=d(),{data:t,error:e}=await n.from("translations").select("*").order("key");if(e){console.error("Error loading translations:",e);return}Z(t||[])}function Z(n){const t=document.getElementById("translationsTable");if(n.length===0){t.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет переводов</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.value}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editTranslation('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteTranslation('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function w(){const n=d(),{data:t,error:e}=await n.from("site_images").select("*").order("key");if(e){console.error("Error loading images:",e);return}z(t||[])}function z(n){const t=document.getElementById("imagesTable");if(n.length===0){t.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет картинок</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><a href="${e.url}" target="_blank">${e.url.substring(0,50)}...</a></td>
      <td>${e.alt_text||"-"}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editImage('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteImage('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function L(){const n=d(),{data:t,error:e}=await n.from("blog_posts").select("*").order("created_at",{ascending:!1});if(e){console.error("Error loading blog posts:",e);return}J(t||[])}function J(n){const t=document.getElementById("blogTable");if(n.length===0){t.innerHTML='<tr><td colspan="6" style="text-align: center; padding: 2rem;">Нет статей</td></tr>';return}t.innerHTML=n.map(e=>`
    <tr>
      <td>${e.title}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.published?"Да":"Нет"}</td>
      <td>${new Date(e.publish_date).toLocaleDateString("ru-RU")}</td>
      <td>${e.views}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editBlogPost('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteBlogPost('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}let m=[];async function I(){const n=d(),{data:t,error:e}=await n.from("leads").select("*").order("created_at",{ascending:!1});if(e){console.error("Error loading leads:",e);return}m=t||[];const s=m.filter(i=>i.is_new).length,l=m.filter(i=>i.source==="demo").length,a=m.filter(i=>i.source==="contact").length,o=document.getElementById("leadsBadge");o&&(o.textContent=String(s),o.classList.toggle("visible",s>0));const r=document.getElementById("leadsTotal"),c=document.getElementById("leadsNew"),u=document.getElementById("leadsDemo"),g=document.getElementById("leadsContact");r&&(r.textContent=String(m.length)),c&&(c.textContent=String(s)),u&&(u.textContent=String(l)),g&&(g.textContent=String(a)),h()}function h(){var s,l,a;const n=((l=(s=document.getElementById("leadsSearch"))==null?void 0:s.value)==null?void 0:l.toLowerCase())||"",t=((a=document.getElementById("leadsSourceFilter"))==null?void 0:a.value)||"";let e=m;t&&(e=e.filter(o=>o.source===t)),n&&(e=e.filter(o=>o.name&&o.name.toLowerCase().includes(n)||o.email&&o.email.toLowerCase().includes(n)||o.telegram&&o.telegram.toLowerCase().includes(n)||o.message&&o.message.toLowerCase().includes(n)||o.referral_source&&o.referral_source.toLowerCase().includes(n))),ne(e)}const te={google:"Google",social_media:"Соц. сети",recommendation:"Рекомендация",ads:"Реклама",other:"Другое"};function ne(n){const t=document.getElementById("leadsContainer");if(n.length===0){t.innerHTML=`
      <div class="empty-leads">
        <div class="empty-leads-icon">--</div>
        <p>Заявок пока нет</p>
      </div>`;return}t.innerHTML=n.map(e=>{const s=new Date(e.created_at).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=e.source==="demo"?"Demo":"Contact",a=e.source==="demo"?"demo":"contact",o=e.broker_experience===!0?"Да":e.broker_experience===!1?"Нет":"-",r=e.referral_source?te[e.referral_source]||y(e.referral_source):"";return`
      <div class="lead-card ${e.is_new?"is-new":""}">
        <div class="lead-card-header">
          <span class="lead-name">${y(e.name||"Без имени")}</span>
          <span class="lead-source ${a}">${l}</span>
        </div>
        <div class="lead-info-grid">
          <div class="lead-info-item">
            <span class="lead-info-label">Email</span>
            <span class="lead-info-value">${y(e.email)}</span>
          </div>
          <div class="lead-info-item">
            <span class="lead-info-label">Telegram</span>
            <span class="lead-info-value ${e.telegram?"":"lead-info-empty"}">${e.telegram?y(e.telegram):"Не указан"}</span>
          </div>
          <div class="lead-info-item">
            <span class="lead-info-label">Опыт брокера</span>
            <span class="lead-info-value">${o}</span>
          </div>
          <div class="lead-info-item">
            <span class="lead-info-label">Откуда узнал</span>
            <span class="lead-info-value ${r?"":"lead-info-empty"}">${r||"-"}</span>
          </div>
          <div class="lead-info-item">
            <span class="lead-info-label">Дата</span>
            <span class="lead-info-value">${s}</span>
          </div>
          <div class="lead-info-item">
            <span class="lead-info-label">Язык</span>
            <span class="lead-info-value">${e.language?e.language.toUpperCase():"-"}</span>
          </div>
        </div>
        ${e.message?`<div class="lead-message">${y(e.message)}</div>`:""}
        <div class="lead-actions">
          ${e.is_new?`<button class="action-btn btn-edit" onclick="markLeadRead('${e.id}')">Прочитано</button>`:""}
          <button class="action-btn btn-delete" onclick="deleteLead('${e.id}')">Удалить</button>
        </div>
      </div>`}).join("")}function y(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}window.markLeadRead=async n=>{try{const t=d(),{error:e}=await t.from("leads").update({is_new:!1}).eq("id",n);if(e){console.error("Error marking lead as read:",e),alert("Ошибка обновления: "+e.message);return}await I()}catch(t){console.error("Error in markLeadRead:",t),alert("Ошибка: "+(t.message||"Не удалось обновить заявку"))}};window.deleteLead=async n=>{if(confirm("Удалить эту заявку?"))try{const t=d(),{error:e}=await t.from("leads").delete().eq("id",n);if(e){console.error("Error deleting lead:",e),alert("Ошибка удаления: "+e.message);return}await I()}catch(t){console.error("Error in deleteLead:",t),alert("Ошибка: "+(t.message||"Не удалось удалить заявку"))}};var $;($=document.getElementById("markAllReadBtn"))==null||$.addEventListener("click",async()=>{try{const n=d(),{error:t}=await n.from("leads").update({is_new:!1}).eq("is_new",!0);if(t){console.error("Error marking all leads as read:",t),alert("Ошибка обновления всех заявок: "+t.message);return}await I()}catch(n){console.error("Error in markAllReadBtn:",n),alert("Ошибка: "+(n.message||"Не удалось обновить заявки"))}});var T;(T=document.getElementById("leadsSearch"))==null||T.addEventListener("input",()=>{h()});var S;(S=document.getElementById("leadsSourceFilter"))==null||S.addEventListener("change",()=>{h()});function Q(){I(),p(),w(),L()}var M;(M=document.getElementById("addTranslationBtn"))==null||M.addEventListener("click",()=>{b=null,document.getElementById("translationModalTitle").textContent="Добавить перевод",document.getElementById("translationForm").reset(),document.getElementById("translationModal").classList.add("active")});var x;(x=document.getElementById("closeTranslationModal"))==null||x.addEventListener("click",()=>{document.getElementById("translationModal").classList.remove("active")});var F;(F=document.getElementById("translationForm"))==null||F.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("translationKey").value,e=document.getElementById("translationLanguage").value,s=document.getElementById("translationValue").value,l=document.getElementById("translationCategory").value,a={key:t,language:e,value:s,category:l},o=d();if(b){const{error:r}=await o.from("translations").update({...a,updated_at:new Date().toISOString()}).eq("id",b);if(r){alert("Ошибка обновления: "+r.message);return}}else{const{error:r}=await o.from("translations").insert([a]);if(r){alert("Ошибка добавления: "+r.message);return}}document.getElementById("translationModal").classList.remove("active"),p()});var q;(q=document.getElementById("addImageBtn"))==null||q.addEventListener("click",()=>{v=null,document.getElementById("imageModalTitle").textContent="Добавить картинку",document.getElementById("imageForm").reset(),document.getElementById("imageModal").classList.add("active")});var D;(D=document.getElementById("closeImageModal"))==null||D.addEventListener("click",()=>{document.getElementById("imageModal").classList.remove("active")});var P;(P=document.getElementById("imageForm"))==null||P.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("imageKey").value,e=document.getElementById("imageUrl").value,s=document.getElementById("imageAlt").value,l=document.getElementById("imageCategory").value,a={key:t,url:e,alt_text:s,category:l},o=d();if(v){const{error:r}=await o.from("site_images").update({...a,updated_at:new Date().toISOString()}).eq("id",v);if(r){alert("Ошибка обновления: "+r.message);return}}else{const{error:r}=await o.from("site_images").insert([a]);if(r){alert("Ошибка добавления: "+r.message);return}}document.getElementById("imageModal").classList.remove("active"),w()});var A;(A=document.getElementById("addBlogBtn"))==null||A.addEventListener("click",()=>{B=null,document.getElementById("blogModalTitle").textContent="Добавить статью",document.getElementById("blogForm").reset(),document.getElementById("blogModal").classList.add("active")});var H;(H=document.getElementById("closeBlogModal"))==null||H.addEventListener("click",()=>{document.getElementById("blogModal").classList.remove("active")});var U;(U=document.getElementById("blogForm"))==null||U.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("blogTitle").value,e=document.getElementById("blogSlug").value,s=document.getElementById("blogLanguage").value,l=document.getElementById("blogExcerpt").value,a=document.getElementById("blogContent").value,o=document.getElementById("blogImageUrl").value,r=document.getElementById("blogPublished").value==="true",c=document.getElementById("blogPublishDate").value,u={title:t,slug:e,language:s,excerpt:l,content:a,image_url:o,published:r,publish_date:c,author:"MakeTrades Team",category:"Trading",tags:["trading"],reading_time:5,meta_title:t,meta_description:l,views:0},g=d();if(B){const{error:i}=await g.from("blog_posts").update({...u,updated_at:new Date().toISOString()}).eq("id",B);if(i){alert("Ошибка обновления: "+i.message);return}}else{const{error:i}=await g.from("blog_posts").insert([u]);if(i){alert("Ошибка добавления: "+i.message);return}}document.getElementById("blogModal").classList.remove("active"),L()});window.editTranslation=async n=>{const t=d(),{data:e}=await t.from("translations").select("*").eq("id",n).single();e&&(b=n,document.getElementById("translationKey").value=e.key,document.getElementById("translationLanguage").value=e.language,document.getElementById("translationValue").value=e.value,document.getElementById("translationCategory").value=e.category,document.getElementById("translationModalTitle").textContent="Изменить перевод",document.getElementById("translationModal").classList.add("active"))};window.deleteTranslation=async n=>{if(!confirm("Удалить этот перевод?"))return;const t=d(),{error:e}=await t.from("translations").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}p()};window.editImage=async n=>{const t=d(),{data:e}=await t.from("site_images").select("*").eq("id",n).single();e&&(v=n,document.getElementById("imageKey").value=e.key,document.getElementById("imageUrl").value=e.url,document.getElementById("imageAlt").value=e.alt_text||"",document.getElementById("imageCategory").value=e.category,document.getElementById("imageModalTitle").textContent="Изменить картинку",document.getElementById("imageModal").classList.add("active"))};window.deleteImage=async n=>{if(!confirm("Удалить эту картинку?"))return;const t=d(),{error:e}=await t.from("site_images").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}w()};window.editBlogPost=async n=>{const t=d(),{data:e}=await t.from("blog_posts").select("*").eq("id",n).single();e&&(B=n,document.getElementById("blogTitle").value=e.title,document.getElementById("blogSlug").value=e.slug,document.getElementById("blogLanguage").value=e.language,document.getElementById("blogExcerpt").value=e.excerpt,document.getElementById("blogContent").value=e.content,document.getElementById("blogImageUrl").value=e.image_url,document.getElementById("blogPublished").value=e.published.toString(),document.getElementById("blogPublishDate").value=e.publish_date.replace("Z","").substring(0,16),document.getElementById("blogModalTitle").textContent="Изменить статью",document.getElementById("blogModal").classList.add("active"))};window.deleteBlogPost=async n=>{if(!confirm("Удалить эту статью?"))return;const t=d(),{error:e}=await t.from("blog_posts").delete().eq("id",n);if(e){alert("Ошибка удаления: "+e.message);return}L()};var R;(R=document.getElementById("translationSearch"))==null||R.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=document.getElementById("translationLangFilter").value,s=document.getElementById("translationCategoryFilter").value;let a=d().from("translations").select("*");e&&(a=a.eq("language",e)),s&&(a=a.eq("category",s));const{data:o}=await a,r=(o||[]).filter(c=>c.key.toLowerCase().includes(t)||c.value.toLowerCase().includes(t));Z(r)});var O;(O=document.getElementById("translationLangFilter"))==null||O.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("translationSearch"))==null||t.dispatchEvent(n)});var j;(j=document.getElementById("translationCategoryFilter"))==null||j.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("translationSearch"))==null||t.dispatchEvent(n)});var K;(K=document.getElementById("imageSearch"))==null||K.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=d(),{data:s}=await e.from("site_images").select("*"),l=(s||[]).filter(a=>a.key.toLowerCase().includes(t)||a.category&&a.category.toLowerCase().includes(t));z(l)});var N;(N=document.getElementById("blogSearch"))==null||N.addEventListener("input",async n=>{const t=n.target.value.toLowerCase(),e=document.getElementById("blogLangFilter").value,s=document.getElementById("blogPublishedFilter").value;let a=d().from("blog_posts").select("*");e&&(a=a.eq("language",e)),s&&(a=a.eq("published",s==="true"));const{data:o}=await a,r=(o||[]).filter(c=>c.title.toLowerCase().includes(t));J(r)});var V;(V=document.getElementById("blogLangFilter"))==null||V.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("blogSearch"))==null||t.dispatchEvent(n)});var G;(G=document.getElementById("blogPublishedFilter"))==null||G.addEventListener("change",()=>{var t;const n=new Event("input");(t=document.getElementById("blogSearch"))==null||t.dispatchEvent(n)});W();
