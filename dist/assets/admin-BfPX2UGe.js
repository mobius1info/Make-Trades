import{b as G}from"./supabase-BKCL4Eps.js";let y=null,b=null,E=null;function s(){return G}function u(t){const n=document.getElementById("loginError");n&&(n.textContent=t,n.style.display="block")}function W(){const t=document.getElementById("loginError");t&&(t.style.display="none")}async function j(){try{const t=s(),{data:{session:n}}=await t.auth.getSession();if(!n)return g(),!1;const{data:e}=await t.from("admin_users").select("*").eq("id",n.user.id).maybeSingle();return e?(Z(),!0):(await t.auth.signOut(),u("У вас нет прав доступа к админ-панели"),g(),!1)}catch(t){return console.error("Auth check error:",t),g(),!1}}function g(){document.getElementById("authContainer").style.display="flex",document.getElementById("adminContent").classList.remove("active")}function Z(){document.getElementById("authContainer").style.display="none",document.getElementById("adminContent").classList.add("active"),J()}var L;(L=document.getElementById("loginForm"))==null||L.addEventListener("submit",async t=>{t.preventDefault(),t.stopPropagation(),W();const n=document.getElementById("loginBtn"),e=document.getElementById("email").value,o=document.getElementById("password").value;if(!e||!o){u("Введите email и пароль");return}n.disabled=!0,n.textContent="Вход...";try{const l=s(),{error:a}=await l.auth.signInWithPassword({email:e,password:o});if(a){u("Ошибка входа: "+a.message),n.disabled=!1,n.textContent="Войти";return}await j()}catch(l){u("Ошибка: "+(l.message||"попробуйте ещё раз")),n.disabled=!1,n.textContent="Войти"}});var h;(h=document.getElementById("logoutBtn"))==null||h.addEventListener("click",async()=>{try{await s().auth.signOut()}catch{}g()});document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",n=>{var l;const e=n.target,o=e.dataset.tab;document.querySelectorAll(".tab-btn").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active")),e.classList.add("active"),(l=document.getElementById(o))==null||l.classList.add("active")})});async function I(){const t=s(),{data:n,error:e}=await t.from("translations").select("*").order("key");if(e){console.error("Error loading translations:",e);return}K(n||[])}function K(t){const n=document.getElementById("translationsTable");if(t.length===0){n.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет переводов</td></tr>';return}n.innerHTML=t.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.value}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editTranslation('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteTranslation('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function B(){const t=s(),{data:n,error:e}=await t.from("site_images").select("*").order("key");if(e){console.error("Error loading images:",e);return}N(n||[])}function N(t){const n=document.getElementById("imagesTable");if(t.length===0){n.innerHTML='<tr><td colspan="5" style="text-align: center; padding: 2rem;">Нет картинок</td></tr>';return}n.innerHTML=t.map(e=>`
    <tr>
      <td>${e.key}</td>
      <td><a href="${e.url}" target="_blank">${e.url.substring(0,50)}...</a></td>
      <td>${e.alt_text||"-"}</td>
      <td>${e.category}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editImage('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteImage('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function f(){const t=s(),{data:n,error:e}=await t.from("blog_posts").select("*").order("created_at",{ascending:!1}).limit(100);if(e){console.error("Error loading blog posts:",e);return}V(n||[])}function V(t){const n=document.getElementById("blogTable");if(t.length===0){n.innerHTML='<tr><td colspan="6" style="text-align: center; padding: 2rem;">Нет статей</td></tr>';return}n.innerHTML=t.map(e=>`
    <tr>
      <td>${e.title}</td>
      <td><strong>${e.language.toUpperCase()}</strong></td>
      <td>${e.published?"Да":"Нет"}</td>
      <td>${new Date(e.publish_date).toLocaleDateString("ru-RU")}</td>
      <td>${e.views}</td>
      <td>
        <button class="action-btn btn-edit" onclick="editBlogPost('${e.id}')">Изменить</button>
        <button class="action-btn btn-delete" onclick="deleteBlogPost('${e.id}')">Удалить</button>
      </td>
    </tr>
  `).join("")}async function v(){const t=s(),{data:n,error:e}=await t.from("leads").select("*").order("created_at",{ascending:!1});if(e){console.error("Error loading leads:",e);return}const o=n||[],l=o.filter(r=>r.is_new).length,a=document.getElementById("leadsBadge");a&&(a.textContent=String(l),a.classList.toggle("visible",l>0));const i=document.getElementById("leadsTotal"),d=document.getElementById("leadsNew");i&&(i.textContent=String(o.length)),d&&(d.textContent=String(l)),z(o)}function z(t){const n=document.getElementById("leadsContainer");if(t.length===0){n.innerHTML=`
      <div class="empty-leads">
        <div class="empty-leads-icon">--</div>
        <p>Заявок пока нет</p>
      </div>`;return}n.innerHTML=t.map(e=>{const o=new Date(e.created_at).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=e.source==="demo"?"Demo":"Contact",a=e.source==="demo"?"demo":"contact";return`
      <div class="lead-card ${e.is_new?"is-new":""}">
        <div class="lead-card-header">
          <span class="lead-name">${m(e.name||"Без имени")}</span>
          <span class="lead-source ${a}">${l}</span>
        </div>
        <div class="lead-meta">
          <span>${m(e.email)}</span>
          ${e.telegram?`<span>TG: ${m(e.telegram)}</span>`:""}
          <span>${o}</span>
          ${e.language?`<span>${e.language.toUpperCase()}</span>`:""}
        </div>
        ${e.message?`<div class="lead-message">${m(e.message)}</div>`:""}
        <div class="lead-actions">
          ${e.is_new?`<button class="action-btn btn-edit" onclick="markLeadRead('${e.id}')">Прочитано</button>`:""}
          <button class="action-btn btn-delete" onclick="deleteLead('${e.id}')">Удалить</button>
        </div>
      </div>`}).join("")}function m(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}window.markLeadRead=async t=>{await s().from("leads").update({is_new:!1}).eq("id",t),v()};window.deleteLead=async t=>{if(!confirm("Удалить эту заявку?"))return;await s().from("leads").delete().eq("id",t),v()};var C;(C=document.getElementById("markAllReadBtn"))==null||C.addEventListener("click",async()=>{await s().from("leads").update({is_new:!1}).eq("is_new",!0),v()});function J(){v(),I(),B(),f()}var _;(_=document.getElementById("addTranslationBtn"))==null||_.addEventListener("click",()=>{y=null,document.getElementById("translationModalTitle").textContent="Добавить перевод",document.getElementById("translationForm").reset(),document.getElementById("translationModal").classList.add("active")});var k;(k=document.getElementById("closeTranslationModal"))==null||k.addEventListener("click",()=>{document.getElementById("translationModal").classList.remove("active")});var $;($=document.getElementById("translationForm"))==null||$.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("translationKey").value,e=document.getElementById("translationLanguage").value,o=document.getElementById("translationValue").value,l=document.getElementById("translationCategory").value,a={key:n,language:e,value:o,category:l},i=s();if(y){const{error:d}=await i.from("translations").update({...a,updated_at:new Date().toISOString()}).eq("id",y);if(d){alert("Ошибка обновления: "+d.message);return}}else{const{error:d}=await i.from("translations").insert([a]);if(d){alert("Ошибка добавления: "+d.message);return}}document.getElementById("translationModal").classList.remove("active"),I()});var T;(T=document.getElementById("addImageBtn"))==null||T.addEventListener("click",()=>{b=null,document.getElementById("imageModalTitle").textContent="Добавить картинку",document.getElementById("imageForm").reset(),document.getElementById("imageModal").classList.add("active")});var M;(M=document.getElementById("closeImageModal"))==null||M.addEventListener("click",()=>{document.getElementById("imageModal").classList.remove("active")});var S;(S=document.getElementById("imageForm"))==null||S.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("imageKey").value,e=document.getElementById("imageUrl").value,o=document.getElementById("imageAlt").value,l=document.getElementById("imageCategory").value,a={key:n,url:e,alt_text:o,category:l},i=s();if(b){const{error:d}=await i.from("site_images").update({...a,updated_at:new Date().toISOString()}).eq("id",b);if(d){alert("Ошибка обновления: "+d.message);return}}else{const{error:d}=await i.from("site_images").insert([a]);if(d){alert("Ошибка добавления: "+d.message);return}}document.getElementById("imageModal").classList.remove("active"),B()});var x;(x=document.getElementById("addBlogBtn"))==null||x.addEventListener("click",()=>{E=null,document.getElementById("blogModalTitle").textContent="Добавить статью",document.getElementById("blogForm").reset(),document.getElementById("blogModal").classList.add("active")});var q;(q=document.getElementById("closeBlogModal"))==null||q.addEventListener("click",()=>{document.getElementById("blogModal").classList.remove("active")});var F;(F=document.getElementById("blogForm"))==null||F.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("blogTitle").value,e=document.getElementById("blogSlug").value,o=document.getElementById("blogLanguage").value,l=document.getElementById("blogExcerpt").value,a=document.getElementById("blogContent").value,i=document.getElementById("blogImageUrl").value,d=document.getElementById("blogPublished").value==="true",r=document.getElementById("blogPublishDate").value,p={title:n,slug:e,language:o,excerpt:l,content:a,image_url:i,published:d,publish_date:r,author:"MakeTrades Team",category:"Trading",tags:["trading"],reading_time:5,meta_title:n,meta_description:l,views:0},w=s();if(E){const{error:c}=await w.from("blog_posts").update({...p,updated_at:new Date().toISOString()}).eq("id",E);if(c){alert("Ошибка обновления: "+c.message);return}}else{const{error:c}=await w.from("blog_posts").insert([p]);if(c){alert("Ошибка добавления: "+c.message);return}}document.getElementById("blogModal").classList.remove("active"),f()});window.editTranslation=async t=>{const n=s(),{data:e}=await n.from("translations").select("*").eq("id",t).single();e&&(y=t,document.getElementById("translationKey").value=e.key,document.getElementById("translationLanguage").value=e.language,document.getElementById("translationValue").value=e.value,document.getElementById("translationCategory").value=e.category,document.getElementById("translationModalTitle").textContent="Изменить перевод",document.getElementById("translationModal").classList.add("active"))};window.deleteTranslation=async t=>{if(!confirm("Удалить этот перевод?"))return;const n=s(),{error:e}=await n.from("translations").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}I()};window.editImage=async t=>{const n=s(),{data:e}=await n.from("site_images").select("*").eq("id",t).single();e&&(b=t,document.getElementById("imageKey").value=e.key,document.getElementById("imageUrl").value=e.url,document.getElementById("imageAlt").value=e.alt_text||"",document.getElementById("imageCategory").value=e.category,document.getElementById("imageModalTitle").textContent="Изменить картинку",document.getElementById("imageModal").classList.add("active"))};window.deleteImage=async t=>{if(!confirm("Удалить эту картинку?"))return;const n=s(),{error:e}=await n.from("site_images").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}B()};window.editBlogPost=async t=>{const n=s(),{data:e}=await n.from("blog_posts").select("*").eq("id",t).single();e&&(E=t,document.getElementById("blogTitle").value=e.title,document.getElementById("blogSlug").value=e.slug,document.getElementById("blogLanguage").value=e.language,document.getElementById("blogExcerpt").value=e.excerpt,document.getElementById("blogContent").value=e.content,document.getElementById("blogImageUrl").value=e.image_url,document.getElementById("blogPublished").value=e.published.toString(),document.getElementById("blogPublishDate").value=e.publish_date.replace("Z","").substring(0,16),document.getElementById("blogModalTitle").textContent="Изменить статью",document.getElementById("blogModal").classList.add("active"))};window.deleteBlogPost=async t=>{if(!confirm("Удалить эту статью?"))return;const n=s(),{error:e}=await n.from("blog_posts").delete().eq("id",t);if(e){alert("Ошибка удаления: "+e.message);return}f()};var P;(P=document.getElementById("translationSearch"))==null||P.addEventListener("input",async t=>{const n=t.target.value.toLowerCase(),e=document.getElementById("translationLangFilter").value,o=document.getElementById("translationCategoryFilter").value;let a=s().from("translations").select("*");e&&(a=a.eq("language",e)),o&&(a=a.eq("category",o));const{data:i}=await a,d=(i||[]).filter(r=>r.key.toLowerCase().includes(n)||r.value.toLowerCase().includes(n));K(d)});var D;(D=document.getElementById("translationLangFilter"))==null||D.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("translationSearch"))==null||n.dispatchEvent(t)});var A;(A=document.getElementById("translationCategoryFilter"))==null||A.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("translationSearch"))==null||n.dispatchEvent(t)});var H;(H=document.getElementById("imageSearch"))==null||H.addEventListener("input",async t=>{const n=t.target.value.toLowerCase(),e=s(),{data:o}=await e.from("site_images").select("*"),l=(o||[]).filter(a=>a.key.toLowerCase().includes(n)||a.category&&a.category.toLowerCase().includes(n));N(l)});var U;(U=document.getElementById("blogSearch"))==null||U.addEventListener("input",async t=>{const n=t.target.value.toLowerCase(),e=document.getElementById("blogLangFilter").value,o=document.getElementById("blogPublishedFilter").value;let a=s().from("blog_posts").select("*").limit(100);e&&(a=a.eq("language",e)),o&&(a=a.eq("published",o==="true"));const{data:i}=await a,d=(i||[]).filter(r=>r.title.toLowerCase().includes(n));V(d)});var O;(O=document.getElementById("blogLangFilter"))==null||O.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("blogSearch"))==null||n.dispatchEvent(t)});var R;(R=document.getElementById("blogPublishedFilter"))==null||R.addEventListener("change",()=>{var n;const t=new Event("input");(n=document.getElementById("blogSearch"))==null||n.dispatchEvent(t)});j();
